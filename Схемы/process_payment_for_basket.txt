@startuml

participant "Абонент"
participant "ЛКА или ПП"
participant "АС Партнёра"
box "Платёжный шлюз"
participant "Адаптер платёжной системы"
participant "Ядро платёжного шлюза"
end box

"Абонент" -> "ЛКА или ПП": Намерение совершить платёж\nID Абонента, одна или несколько услуг\nсумма для каждой услуги
activate "Абонент"
activate "ЛКА или ПП"
"ЛКА или ПП" -> "Ядро платёжного шлюза": Регистрация корзины
activate "Ядро платёжного шлюза"
ref over "Ядро платёжного шлюза"
Регистрация корзины
end ref
"Ядро платёжного шлюза" -> "ЛКА или ПП": Корзина зарегистрирована
deactivate "Ядро платёжного шлюза"

"ЛКА или ПП" -> "АС Партнёра": Провести платёж\nID корзины, сумма платежа
activate "АС Партнёра"
deactivate "ЛКА или ПП"

"АС Партнёра" -> "Адаптер платёжной системы": Запрос возможности платежа\nпо протоколу партнёра
activate "Адаптер платёжной системы"
"Адаптер платёжной системы" -> "Ядро платёжного шлюза": Запрос возможности платежа по корзине
activate "Ядро платёжного шлюза"
ref over "Ядро платёжного шлюза"
Запрос возможности платежа по корзине
end ref
"Ядро платёжного шлюза" -> "Адаптер платёжной системы": Оплата корзины возможна
deactivate "Ядро платёжного шлюза"
"Адаптер платёжной системы" -> "АС Партнёра": Оплата корзины возможна\nпо протоколу партнёра
deactivate "Адаптер платёжной системы"

"АС Партнёра" -> "Абонент": SMS c запросом подтверждения платежа
"Абонент" -> "АС Партнёра": SMS с подтверждением платежа

"АС Партнёра" -> "Адаптер платёжной системы": Платёж\nпо протоколу партнёра
activate "Адаптер платёжной системы"
"Адаптер платёжной системы" -> "Ядро платёжного шлюза": Платёж по корзине
activate "Ядро платёжного шлюза"
ref over "Ядро платёжного шлюза"
Платёж по корзине
end ref
"Ядро платёжного шлюза" -> "Адаптер платёжной системы": Платёж принят
deactivate "Ядро платёжного шлюза"
"Адаптер платёжной системы" -> "АС Партнёра": Платёж принят\nпо протоколу партнёра
deactivate "Адаптер платёжной системы"

"АС Партнёра" -> "Абонент": SMS: завершение платежа
deactivate "АС Партнёра"
deactivate "Абонент"

@enduml