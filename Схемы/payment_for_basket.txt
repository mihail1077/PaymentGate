@startuml

participant "Платёжная система"
participant "Платёжный шлюз"
participant "Биллинг абонента"


"Платёжная система" -> "Платёжный шлюз": Платёж по корзине
activate "Платёжная система"
activate "Платёжный шлюз"
"Платёжный шлюз" -> "Платёжный шлюз": Поиск сохранённой корзины
"Платёжный шлюз" -> "Платёжный шлюз": Фиксация факта оплаты
"Платёжный шлюз" -> "Платёжная система": Платёж принят
deactivate "Платёжная система"

loop Для каждой услуги из корзины
|||
ref over "Платёжный шлюз": <<Precheck>>
"Платёжный шлюз" -> "Биллинг абонента": Платёж
activate "Биллинг абонента"
"Биллинг абонента" -> "Платёжный шлюз": Платёж зарегистрирован
deactivate "Биллинг абонента"
end

deactivate "Платёжный шлюз"

@enduml