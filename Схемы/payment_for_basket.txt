@startuml

participant "Платёжная система"
participant "Платёжный шлюз"
participant "BSS абонента"


"Платёжная система" -> "Платёжный шлюз": Платёж по корзине
activate "Платёжная система"
activate "Платёжный шлюз"
"Платёжный шлюз" -> "Платёжный шлюз": Поиск сохранённой корзины
"Платёжный шлюз" -> "Платёжный шлюз": Опеределение BSS-системы абонента

loop Для каждой услуги из корзины
"Платёжный шлюз" -> "BSS абонента": Запрос возможности платежа
activate "BSS абонента"
"BSS абонента" -> "Платёжный шлюз": Приём платежа разрешён
deactivate "BSS абонента"
end

"Платёжный шлюз" -> "Платёжный шлюз": Фиксация факта оплаты
"Платёжный шлюз" -> "Платёжная система": Платёж принят

deactivate "Платёжная система"

loop Для каждой услуги из корзины
"Платёжный шлюз" -> "BSS абонента": Платёж
activate "BSS абонента"
"BSS абонента" -> "Платёжный шлюз": Платёж зарегистрирован
deactivate "BSS абонента"
end

deactivate "Платёжный шлюз"

@enduml