@startuml

participant "Адаптер платёжной системы"
participant "Платёжный шлюз"
participant "Адаптер биллинга"


"Адаптер платёжной системы" -> "Платёжный шлюз": Платёж по корзине
activate "Адаптер платёжной системы"
activate "Платёжный шлюз"
"Платёжный шлюз" -> "Платёжный шлюз": Поиск сохранённой корзины
"Платёжный шлюз" -> "Платёжный шлюз": Фиксация факта оплаты
"Платёжный шлюз" -> "Адаптер платёжной системы": Платёж принят
deactivate "Адаптер платёжной системы"

loop Для каждой услуги из корзины

"Платёжный шлюз" -> "Адаптер биллинга": Проверка возможности совершения платежа(Precheck)
activate "Адаптер биллинга"
"Адаптер биллинга" -> "Платёжный шлюз": Проверка выполнена
deactivate "Адаптер биллинга"

"Платёжный шлюз" -> "Адаптер биллинга": Платёж
activate "Адаптер биллинга"
"Адаптер биллинга" -> "Платёжный шлюз": Платёж зарегистрирован
deactivate "Адаптер биллинга"

end

deactivate "Платёжный шлюз"

@enduml