@startuml

participant "Ядро платёжного шлюза"
participant "Адаптер биллинга"
participant "Биллинг"


"Ядро платёжного шлюза" -> "Адаптер биллинга": Платёж
activate "Ядро платёжного шлюза"
activate "Адаптер биллинга"

"Адаптер биллинга" -> "Адаптер биллинга": Precheck с кодом услуги

alt Удалось определить биллинговый код услуги
"Адаптер биллинга" -> "Биллинг": Зачисление целевого платежа
activate "Биллинг"
"Биллинг" -> "Адаптер биллинга": Платёж зачислен
deactivate "Биллинг"

else Не удалось определить биллинговый код услуги

opt
"Адаптер биллинга" -> "Адаптер биллинга": Precheck без кода услуги
end

"Адаптер биллинга" -> "Биллинг": Зачисление нецелевого платежа
activate "Биллинг"
"Биллинг" -> "Адаптер биллинга": Платёж зачислен
deactivate "Биллинг"

else Платёж на абонента невозможен
"Адаптер биллинга" -> "Биллинг": Зачисление на счёт нераспознанных
activate "Биллинг"
"Биллинг" -> "Адаптер биллинга": Платёж зачислен
deactivate "Биллинг"

end

"Адаптер биллинга" -> "Ядро платёжного шлюза": Платёж зачислен

deactivate "Ядро платёжного шлюза"
deactivate "Адаптер биллинга"

@enduml